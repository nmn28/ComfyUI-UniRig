# ComfyUI-UniRig - Environment Configuration
# Run: comfy-env install

# ═══════════════════════════════════════════════════════════════════════════════
# TOOLS
# ═══════════════════════════════════════════════════════════════════════════════

[tools]
blender = "4.2"

# ═══════════════════════════════════════════════════════════════════════════════
# ISOLATED ENVIRONMENT
# ═══════════════════════════════════════════════════════════════════════════════

[unirig]
python = "3.11"            # Python 3.11 required for bpy (Blender as Python module)
cuda_version = "auto"      # Auto-detect from system
pytorch_version = "auto"   # Auto-detect compatible version

    [unirig.cuda]
    # CUDA extensions - resolved automatically by comfy-env
    torch-scatter = "2.1.2"
    torch-cluster = "1.6.3"
    cumm-cu126 = "*"      # Required by spconv (must match CUDA version)
    spconv-cu126 = "*"
    flash-attn = "2.8.3"

    [unirig.packages]
    requirements = [
        # Blender as Python module (direct import, no subprocess for preprocessing)
        # Using 4.2 to match original UniRig
        "bpy==4.2",

        # Core
        "trimesh[easy]",  # Include optional deps like shapely
        "numpy<2.0",      # bpy requires numpy<2.0
        "scipy",
        "embreex",  # Required for trimesh ray casting
        "pccm",     # Required by spconv
        "shapely",  # Required by trimesh for mesh slicing

        # UniRig dependencies
        "transformers==4.51.3",
        "python-box",
        "einops",
        "omegaconf",
        "pytorch_lightning",
        "lightning",
        "addict",
        "timm",
        "huggingface_hub",
        "wandb",
        "fast-simplification",

        # Mesh processing
        "pyrender",
        "libigl",
    ]

    [unirig.packages.windows]
    requirements = ["triton-windows>=3.5.0"]

    [unirig.packages.linux]
    requirements = ["triton>=3.0.0"]

# ═══════════════════════════════════════════════════════════════════════════════
# NODE DEPENDENCIES
# ═══════════════════════════════════════════════════════════════════════════════
# Other ComfyUI custom nodes required by workflows

[node_reqs]
ComfyUI-GeometryPack = "PozzettiAndrea/ComfyUI-GeometryPack"